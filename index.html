<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width">
    <title>Chess</title>
    <style>
        body { background: #1a1a2e; min-height: 100vh; display: flex; flex-direction: column; align-items: center; padding: 10px; font-family: Arial; }
        h1 { color: white; margin: 10px; }
        .menu { display: flex; flex-direction: column; gap: 10px; }
        .menu button { padding: 15px 40px; font-size: 18px; background: #333; color: white; border: 2px solid #555; border-radius: 8px; cursor: pointer; }
        #game { display: none; width: min(90vw, 400px); }
        #game.show { display: block; }
        #board { display: grid; grid-template-columns: repeat(8, 1fr); width: 100%; aspect-ratio: 1; border: 5px solid #654321; }
        .sq { display: flex; align-items: center; justify-content: center; font-size: clamp(20px, 8vw, 40px); cursor: pointer; }
        .light { background: #f0d9b5; }
        .dark { background: #b58863; }
        .selected { background: #baca44 !important; }
        .hint::after { content: ''; position: absolute; width: 20%; height: 20%; background: rgba(0,200,0,0.4); border-radius: 50%; }
        .hint { position: relative; }
        .piece { cursor: grab; }
        .w-piece { color: #fff; text-shadow: 1px 1px 2px #000; }
        .b-piece { color: #000; }
        #status { color: #ccc; padding: 10px; text-align: center; }
        #back { margin-top: 15px; padding: 10px 25px; background: #e94560; color: white; border: none; border-radius: 5px; cursor: pointer; }
    </style>
</head>
<body>
    <h1>Chess</h1>
    <div class="menu" id="menu">
        <button onclick="startPVP()">vs Player</button>
        <button onclick="startPVC()">vs Computer</button>
    </div>
    <div id="game">
        <div id="status"></div>
        <div id="board"></div>
        <button id="back" onclick="showMenu()">Menu</button>
    </div>

<script>
// Chess logic
const SYMBOLS = { w: { k:'♔', q:'♕', r:'♖', b:'♗', n:'♘', p:'♙' }, b: { k:'♚', q:'♛', r:'♜', b:'♝', n:'♞', p:'♟' }};
const START = [
    ['r','n','b','q','k','b','n','r'],
    ['p','p','p','p','p','p','p','p'],
    [0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0],
    [0,0,0,0,0,0,0,0],
    ['P','P','P','P','P','P','P','P'],
    ['R','N','B','Q','K','B','N','R']
];

let board = [], turn = 'w', selected = null, hints = [], mode = 'pvp';

function startPVP() { mode = 'pvp'; startGame(); }
function startPVC() { mode = 'pvc'; startGame(); }

function startGame() {
    board = START.map(r => r.map(c => c ? { color: c===c.toUpperCase()?'w':'b', type:c.toLowerCase() } : null));
    turn = 'w'; selected = null; hints = [];
    document.getElementById('menu').style.display = 'none';
    document.getElementById('game').classList.add('show');
    render();
}

function showMenu() {
    document.getElementById('menu').style.display = 'flex';
    document.getElementById('game').classList.remove('show');
}

function getMoves(r, c, checkCheck) {
    const p = board[r][c]; if (!p) return [];
    const moves = [], color = p.color, type = p.type;
    const add = (tr, tc) => {
        if (tr<0||tr>7||tc<0||tc>7) return false;
        const t = board[tr][tc];
        if (t) { if (t.color!==color) moves.push([tr,tc]); return false; }
        moves.push([tr,tc]); return true;
    };
    if (type==='p') {
        const d = color==='w'?-1:1, start = color==='w'?6:1;
        if (!board[r+d]?.[c]) { add(r+d,c); if (r===start && !board[r+2*d]?.[c]) moves.push([r+2*d,c]); }
        [[d,-1],[d,1]].forEach(([dr,dc]) => { const tr=r+dr,tc=c+dc; if (tr>=0&&tr<8&&tc>=0&&tc<8&&board[tr][tc]?.color!==color) moves.push([tr,tc]); });
    }
    if (type==='n') [[-2,-1],[-2,1],[-1,-2],[-1,2],[1,-2],[1,2],[2,-1],[2,1]].forEach(([dr,dc])=>add(r+dr,c+dc));
    if (type==='b'||type==='q') [[1,1],[1,-1],[-1,1],[-1,-1]].forEach(([dr,dc])=>{ for(let i=1;i<8;i++) if(!add(r+dr*i,c+dc*i)) break; });
    if (type==='r'||type==='q') [[1,0],[-1,0],[0,1],[0,-1]].forEach(([dr,dc])=>{ for(let i=1;i<8;i++) if(!add(r+dr*i,c+dc*i)) break; });
    if (type==='k') [[1,0],[-1,0],[0,1],[0,-1],[1,1],[1,-1],[-1,1],[-1,-1]].forEach(([dr,dc])=>add(r+dr,c+dc));
    if (checkCheck) return moves.filter(m => { const nb=board.map(r=>r.map(c=>c?{...c}:null)); nb[m[0]][m[1]]=nb[r][c]; nb[r][c]=null; return !inCheck(nb,color); });
    return moves;
}

function inCheck(bd, color) {
    let kr,kc; bd.forEach((r,ri)=>r.forEach((c,ci)=>{ if(c?.type==='k'&&c.color===color){ kr=ri; kc=ci; }}));
    if (kr===undefined) return false;
    for (let ri=0;ri<8;ri++) for (let ci=0;ci<8;ci++) { const p=bd[ri][ci]; if(p?.color!==color) { const ms=getRawMoves(bd,ri,ci,p.type); if(ms.some(m=>m[0]===kr&&m[1]===kc)) return true; } }
    return false;
}

function getRawMoves(bd, r, c, type) {
    const moves = [], color = bd[r][c].color;
    const add = (tr, tc) => { if(tr<0||tr>7||tc<0||tc>7)return false; const t=bd[tr][tc]; if(t){if(t.color!==color){moves.push([tr,tc]);}return false;}moves.push([tr,tc]);return true;};
    if (type==='p') { const d=color==='w'?-1:1; if(!bd[r+d]?.[c]){add(r+d,c);} [[d,-1],[d,1]].forEach(([dr,dc])=>{const tr=r+dr,tc=c+dc;if(tr>=0&&tr<8&&tc>=0&&tc<8&&bd[tr][tc]?.color!==color)moves.push([tr,tc]);}); }
    if (type==='n') [[-2,-1],[-2,1],[-1,-2],[-1,2],[1,-2],[1,2],[2,-1],[2,1]].forEach(([dr,dc])=>add(r+dr,c+dc));
    if (type==='b'||type==='q') [[1,1],[1,-1],[-1,1],[-1,-1]].forEach(([dr,dc])=>{for(let i=1;i<8;i++)if(!add(r+dr*i,c+dc*i))break;});
    if (type==='r'||type==='q') [[1,0],[-1,0],[0,1],[0,-1]].forEach(([dr,dc])=>{for(let i=1;i<8;i++)if(!add(r+dr*i,c+dc*i))break;});
    if (type==='k') [[1,0],[-1,0],[0,1],[0,-1],[1,1],[1,-1],[-1,1],[-1,-1]].forEach(([dr,dc])=>add(r+dr,c+dc));
    return moves;
}

function render() {
    const el = document.getElementById('board'); el.innerHTML = '';
    for (let r = 0; r < 8; r++) {
        for (let c = 0; c < 8; c++) {
            const sq = document.createElement('div');
            sq.className = 'sq ' + ((r + c) % 2 === 0 ? 'light' : 'dark');
            if (selected && selected[0]===r && selected[1]===c) sq.classList.add('selected');
            if (hints.some(h=>h[0]===r && h[1]===c)) sq.classList.add('hint');
            const p = board[r][c];
            if (p) { sq.innerHTML = '<span class="piece '+(p.color==='w'?'w-piece':'b-piece')+'">'+SYMBOLS[p.color][p.type]+'</span>'; }
            sq.onclick = () => click(r,c);
            el.appendChild(sq);
        }
    }
    document.getElementById('status').textContent = turn==='w'?"White's turn":"Black's turn";
}

function click(r, c) {
    if (mode==='pvc' && turn==='b') return;
    const p = board[r][c];
    if (p && p.color === turn) { selected=[r,c]; hints=getMoves(r,c,true); render(); }
    else if (selected && hints.some(h=>h[0]===r && h[1]===c)) { move(selected[0],selected[1],r,c); }
}

function move(fr, fc, tr, tc) {
    board[tr][tc] = board[fr][fc]; board[fr][fc] = null;
    if (board[tr][tc].type==='p' && (tr===0 || tr===7)) board[tr][tc].type = 'q';
    selected = null; hints = []; turn = turn==='w'?'b':'w';
    render();
    if (mode==='pvc' && turn==='b') setTimeout(compMove, 300);
}

function compMove() {
    let all = [];
    for (let r=0;r<8;r++) for (let c=0;c<8;c++) if (board[r][c]?.color==='b') getMoves(r,c,true).forEach(m=>all.push([[r,c],m]));
    if (all.length) { const m=all[Math.floor(Math.random()*all.length)]; move(m[0][0],m[0][1],m[1][0],m[1][1]); }
}
</script>
</body>
</html>
