<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>♟️ Chess</title>
    <link rel="stylesheet"
      href="https://unpkg.com/@chrisoakman/chessboardjs@1.0.0/dist/chessboard-1.0.0.min.css">
    <style>
        * { box-sizing: border-box; margin: 0; padding: 0; }
        body {
            font-family: system-ui, -apple-system, sans-serif;
            background: #1a1a2e;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px;
        }
        h1 { color: white; margin-bottom: 10px; }
        
        .menu { display: flex; flex-direction: column; gap: 10px; }
        .menu button {
            padding: 15px 40px;
            font-size: 18px;
            background: #333;
            color: white;
            border: 2px solid #555;
            border-radius: 10px;
            cursor: pointer;
        }
        .menu button:hover { background: #444; }
        
        #game-container { display: none; flex-direction: column; align-items: center; }
        #game-container.active { display: flex; }
        
        #board {
            width: 360px;
            margin: 10px 0;
        }
        
        #status {
            color: #ccc;
            margin: 10px;
            font-size: 16px;
        }
        
        .info {
            color: #888;
            font-size: 14px;
            margin: 5px;
        }
        
        .back-btn {
            margin-top: 15px;
            padding: 10px 20px;
            background: #e94560;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }
    </style>
</head>
<body>
    <!-- Menu -->
    <div id="menu">
        <h1>♟️ Chess</h1>
        <div class="menu">
            <button onclick="startGame('pvp')">vs Player</button>
            <button onclick="startGame('pvc')">vs Computer</button>
        </div>
    </div>
    
    <!-- Game -->
    <div id="game-container">
        <h1 id="mode-title">vs Player</h1>
        <div id="board"></div>
        <div id="status"></div>
        <div class="info" id="fen"></div>
        <button class="back-btn" onclick="backToMenu()">Back to Menu</button>
    </div>

    <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
    <script src="https://unpkg.com/@chrisoakman/chessboardjs@1.0.0/dist/chessboard-1.0.0.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/chess.js/0.10.3/chess.min.js"></script>
    
    <script>
        var board = null;
        var game = new Chess();
        var mode = 'pvp';
        var $status = $('#status');
        var $fen = $('#fen');
        
        function startGame(selectedMode) {
            mode = selectedMode;
            $('#menu').hide();
            $('#game-container').addClass('active');
            $('#mode-title').text(mode === 'pvp' ? 'vs Player' : 'vs Computer');
            
            game.reset();
            board = Chessboard('board', {
                draggable: true,
                position: 'start',
                onDragStart: onDragStart,
                onDrop: onDrop,
                onSnapEnd: onSnapEnd
            });
            updateStatus();
        }
        
        function backToMenu() {
            $('#game-container').removeClass('active');
            $('#menu').show();
            board = null;
        }
        
        function onDragStart(source, piece, position, orientation) {
            // Don't pick up pieces if game over
            if (game.game_over()) return false;
            
            // Only pick own pieces
            if (mode === 'pvp') {
                if ((game.turn() === 'w' && piece.search(/^b/) !== -1) ||
                    (game.turn() === 'b' && piece.search(/^w/) !== -1)) {
                    return false;
                }
            } else {
                // vs computer - only white pieces draggable
                if (piece.search(/^b/) !== -1) return false;
            }
        }
        
        function onDrop(source, target) {
            // See if the move is legal
            var move = game.move({
                from: source,
                to: target,
                promotion: 'q'
            });
            
            // Illegal move
            if (move === null) return 'snapback';
            
            updateStatus();
            
            // Computer move
            if (mode === 'pvc' && game.turn() === 'b') {
                setTimeout(makeComputerMove, 250);
            }
        }
        
        function makeComputerMove() {
            var possibleMoves = game.moves();
            
            if (game.game_over() || possibleMoves.length === 0) return;
            
            // Random move for now
            var randomIdx = Math.floor(Math.random() * possibleMoves.length);
            game.move(possibleMoves[randomIdx]);
            
            board.position(game.fen());
            updateStatus();
        }
        
        function onSnapEnd() {
            board.position(game.fen());
        }
        
        function updateStatus() {
            var status = '';
            var moveColor = game.turn() === 'b' ? 'Black' : 'White';
            
            if (game.in_checkmate()) {
                status = 'Game over, ' + moveColor + ' is in checkmate.';
            } else if (game.in_draw()) {
                status = 'Game over, drawn position';
            } else {
                status = moveColor + "'s turn";
                if (game.in_check()) {
                    status += ', ' + moveColor + ' is in check';
                }
            }
            
            $status.text(status);
            $fen.text('FEN: ' + game.fen());
        }
        
        // Start with menu visible
        $('#menu').show();
    </script>
</body>
</html>
