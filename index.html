<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>♟️ Chess - 2 Player</title>
    <style>
        * { box-sizing: border-box; margin: 0; padding: 0; }
        body {
            background: #1a1a2e;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            font-family: system-ui;
        }
        h1 { color: white; margin-bottom: 1rem; }
        #board {
            display: grid;
            grid-template-columns: repeat(8, 60px);
            grid-template-rows: repeat(8, 60px);
            border: 5px solid #4a3728;
            user-select: none;
        }
        .square {
            width: 60px;
            height: 60px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 40px;
            cursor: pointer;
        }
        .white { background: #f0d9b5; color: black; }
        .black { background: #b58863; color: black; }
        .selected { box-shadow: inset 0 0 0 3px #ffff00; }
        .possible { box-shadow: inset 0 0 0 3px #00ff00; }
        .last-move { background: #badc58 !important; }
        #status { color: white; margin: 1rem; font-size: 1.2rem; }
        #reset { 
            padding: 0.5rem 1.5rem; 
            background: #e94560; 
            color: white; 
            border: none; 
            border-radius: 5px; 
            cursor: pointer;
            font-size: 1rem;
            margin-top: 1rem;
        }
        #reset:hover { background: #ff6b6b; }
    </style>
</head>
<body>
    <h1>♟️ Chess</h1>
    <div id="status">White's turn</div>
    <div id="board"></div>
    <button id="reset" onclick="initGame()">New Game</button>

    <script>
        const pieces = {
            'r': '♜', 'n': '♞', 'b': '♝', 'q': '♛', 'k': '♚', 'p': '♟',
            'R': '♜', 'N': '♞', 'B': '♝', 'Q': '♛', 'K': '♚', 'P': '♟'
        };
        
        const initialBoard = [
            ['r','n','b','q','k','b','n','r'],
            ['p','p','p','p','p','p','p','p'],
            ['','','','','','','',''],
            ['','','','','','','',''],
            ['','','','','','','',''],
            ['','','','','','','',''],
            ['P','P','P','P','P','P','P','P'],
            ['R','N','B','Q','K','B','N','R']
        ];
        
        let board = [];
        let turn = 'white';
        let selected = null;
        let possibleMoves = [];
        
        function initGame() {
            board = initialBoard.map(row => [...row]);
            turn = 'white';
            selected = null;
            possibleMoves = [];
            render();
        }
        
        function render() {
            const boardEl = document.getElementById('board');
            boardEl.innerHTML = '';
            
            for (let r = 0; r < 8; r++) {
                for (let c = 0; c < 8; c++) {
                    const sq = document.createElement('div');
                    sq.className = `square ${(r + c) % 2 === 0 ? 'white' : 'black'}`;
                    sq.dataset.r = r;
                    sq.dataset.c = c;
                    
                    const piece = board[r][c];
                    if (piece) {
                        sq.textContent = pieces[piece];
                        if (piece === piece.toUpperCase() && turn === 'white') sq.style.color = '#fff';
                        if (piece === piece.toLowerCase() && turn === 'black') sq.style.color = '#000';
                    }
                    
                    if (selected && selected.r === r && selected.c === c) {
                        sq.classList.add('selected');
                    }
                    if (possibleMoves.some(m => m.r === r && m.c === c)) {
                        sq.classList.add('possible');
                    }
                    
                    sq.onclick = () => handleClick(r, c);
                    boardEl.appendChild(sq);
                }
            }
            
            document.getElementById('status').textContent = 
                turn === 'white' ? "White's turn" : "Black's turn";
        }
        
        function handleClick(r, c) {
            const piece = board[r][c];
            const isMyPiece = piece && (turn === 'white' ? piece === piece.toUpperCase() : piece === piece.toLowerCase());
            
            if (isMyPiece) {
                selected = {r, c};
                possibleMoves = getValidMoves(r, c, piece);
                render();
            } else if (selected && possibleMoves.some(m => m.r === r && m.c === c)) {
                // Move
                board[r][c] = board[selected.r][selected.c];
                board[selected.r][selected.c] = '';
                
                // Pawn promotion
                if (board[r][c] === 'P' && r === 0) board[r][c] = 'Q';
                if (board[r][c] === 'p' && r === 7) board[r][c] = 'q';
                
                selected = null;
                possibleMoves = [];
                turn = turn === 'white' ? 'black' : 'white';
                render();
            }
        }
        
        function getValidMoves(r, c, piece) {
            const moves = [];
            const isWhite = piece === piece.toUpperCase();
            const direction = isWhite ? -1 : 1;
            
            const addIfValid = (r, c) => {
                if (r >= 0 && r < 8 && c >= 0 && c < 8) {
                    const target = board[r][c];
                    if (!target || (isWhite ? target === target.toLowerCase() : target === target.toUpperCase())) {
                        moves.push({r, c});
                    }
                }
            };
            
            switch(piece.toLowerCase()) {
                case 'p':
                    // Forward
                    if (board[r + direction]?.[c] === '') {
                        addIfValid(r + direction, c);
                        // Double start
                        if ((isWhite && r === 6) || (!isWhite && r === 1)) {
                            if (board[r + 2 * direction]?.[c] === '') {
                                addIfValid(r + 2 * direction, c);
                            }
                        }
                    }
                    // Capture
                    addIfValid(r + direction, c - 1);
                    addIfValid(r + direction, c + 1);
                    break;
                    
                case 'r':
                    [[1,0],[-1,0],[0,1],[0,-1]].forEach(([dr, dc]) => {
                        for (let i = 1; i < 8; i++) {
                            if (!addSlide(r + dr*i, c + dc*i)) break;
                        }
                    });
                    break;
                    
                case 'b':
                    [[1,1],[1,-1],[-1,1],[-1,-1]].forEach(([dr, dc]) => {
                        for (let i = 1; i < 8; i++) {
                            if (!addSlide(r + dr*i, c + dc*i)) break;
                        }
                    });
                    break;
                    
                case 'q':
                    [[1,0],[-1,0],[0,1],[0,-1],[1,1],[1,-1],[-1,1],[-1,-1]].forEach(([dr, dc]) => {
                        for (let i = 1; i < 8; i++) {
                            if (!addSlide(r + dr*i, c + dc*i)) break;
                        }
                    });
                    break;
                    
                case 'n':
                    [[2,1],[2,-1],[-2,1],[-2,-1],[1,2],[1,-2],[-1,2],[-1,-2]].forEach(([dr, dc]) => {
                        addIfValid(r + dr, c + dc);
                    });
                    break;
                    
                case 'k':
                    [[1,0],[-1,0],[0,1],[0,-1],[1,1],[1,-1],[-1,1],[-1,-1]].forEach(([dr, dc]) => {
                        addIfValid(r + dr, c + dc);
                    });
                    break;
            }
            
            function addSlide(r, c) {
                if (r < 0 || r > 7 || c < 0 || c > 7) return false;
                const target = board[r][c];
                if (!target) {
                    moves.push({r, c});
                    return true;
                }
                if (isWhite ? target === target.toLowerCase() : target === target.toUpperCase()) {
                    moves.push({r, c});
                }
                return false;
            }
            
            return moves;
        }
        
        initGame();
    </script>
</body>
</html>
